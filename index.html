<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TashBoss: –ì–æ—Ä–æ–¥—Å–∫–∞—è –ò–º–ø–µ—Ä–∏—è</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1e293b; /* –ë–æ–ª–µ–µ –º—è–≥–∫–∏–π —Ç–µ–º–Ω—ã–π —Ñ–æ–Ω */
            color: #f8fafc;
            min-height: 100vh;
        }
        .app-container {
            max-width: 600px;
            margin: auto;
            padding: 1rem;
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #a5f3fc;
            border-bottom: 2px solid #06b6d4;
            padding-bottom: 0.5rem;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }
        .card {
            background-color: #334155;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            padding: 1rem;
        }
        .profit-button {
            transition: background-color 0.2s, transform 0.1s;
        }
        .profit-button:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <h1 class="text-3xl font-extrabold text-center mb-6 text-teal-400">
            TashBoss üèôÔ∏è
        </h1>

        <!-- –ë–ª–æ–∫ —Å—á–µ—Ç–∞ –∏ –ø—Ä–∏–±—ã–ª–∏ -->
        <div class="card mb-6">
            <p class="text-lg text-gray-400">üí∞ BossCoin (BSS):</p>
            <p id="score-display" class="text-5xl font-black text-white mt-1 mb-4">0</p>
            
            <div id="profit-section" class="flex items-center justify-between mt-4">
                <div>
                    <p class="text-sm text-gray-400">–ù–∞–∫–æ–ø–ª–µ–Ω–Ω–∞—è –ø—Ä–∏–±—ã–ª—å:</p>
                    <p id="profit-display" class="text-2xl font-bold text-yellow-400">0 BSS</p>
                </div>
                <button id="collect-button" class="profit-button bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg text-lg disabled:opacity-50" disabled>
                    –°–æ–±—Ä–∞—Ç—å
                </button>
            </div>
            <p id="production-display" class="text-sm text-gray-400 mt-2 text-right">
                –û–±—â–∏–π –¥–æ—Ö–æ–¥ –∑–∞ —Ü–∏–∫–ª: 0 BSS
            </p>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è –∏ —Å—Ç–∞—Ç—É—Å -->
        <div id="loading-status" class="text-center py-4 text-sky-400 font-semibold">
            –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
        </div>
        <div id="message-box" class="card bg-red-800 text-white p-3 mb-4 hidden"></div>

        <!-- –°–ø–∏—Å–æ–∫ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –æ—Ç—Ä–∞—Å–ª–µ–π -->
        <div class="section-title">üè≠ –ú–æ–∏ –û—Ç—Ä–∞—Å–ª–∏</div>
        <div id="owned-industries-list" class="space-y-3">
            <p class="text-gray-400 text-center" id="no-industries-msg">
                –£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç –æ—Ç—Ä–∞—Å–ª–µ–π. –ö—É–ø–∏—Ç–µ –ø–µ—Ä–≤—É—é!
            </p>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ—Ç—Ä–∞—Å–ª–µ–π -->
        <div class="section-title">üõí –î–æ—Å—Ç—É–ø–Ω—ã–µ –û—Ç—Ä–∞—Å–ª–∏</div>
        <div id="available-industries-list" class="space-y-4">
            <!-- –°–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω JS -->
        </div>

    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        // NOTE: –í —Ä–µ–∞–ª—å–Ω–æ–º Mini App USER_ID –¥–æ–ª–∂–µ–Ω –∏–∑–≤–ª–µ–∫–∞—Ç—å—Å—è –∏–∑ WebApp.initDataUnsafe
        // –î–ª—è Canvas –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π ID
        const USER_ID = "test_user_12345"; 
        const BASE_API_URL = window.location.origin; 
        
        // DOM Elements
        const scoreDisplay = document.getElementById('score-display');
        const profitDisplay = document.getElementById('profit-display');
        const productionDisplay = document.getElementById('production-display');
        const collectButton = document.getElementById('collect-button');
        const loadingStatus = document.getElementById('loading-status');
        const messageBox = document.getElementById('message-box');
        const ownedList = document.getElementById('owned-industries-list');
        const availableList = document.getElementById('available-industries-list');
        const noIndustriesMsg = document.getElementById('no-industries-msg');

        // Game State (Global)
        let masterIndustries = [];
        let playerState = {
            score: 0,
            industries: [],
            accumulated_profit: 0,
            total_production: 0,
            last_check_time: 0
        };
        
        // –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI (–¥–ª—è —Ç–∞–π–º–µ—Ä–∞ –ø—Ä–∏–±—ã–ª–∏)
        let uiUpdateInterval = null;

        /**
         * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –∏–ª–∏ –æ—à–∏–±–∫–µ.
         */
        function showMessage(text, isError = false) {
            messageBox.textContent = text;
            messageBox.className = `card p-3 mb-4 ${isError ? 'bg-red-800' : 'bg-blue-600'} text-white`;
            messageBox.classList.remove('hidden');
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 3000);
        }

        /**
         * –í—ã–ø–æ–ª–Ω—è–µ—Ç API-–∑–∞–ø—Ä–æ—Å —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫.
         */
        async function apiRequest(endpoint, method = 'GET') {
            try {
                const url = `${BASE_API_URL}${endpoint}`;
                const response = await fetch(url, { method });

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫—É HTTP-—Å—Ç–∞—Ç—É—Å–∞
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ detail: 'Unknown error' }));
                    throw new Error(errorData.detail || `HTTP error! Status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error("API Request Failed:", error);
                showMessage(`–û—à–∏–±–∫–∞ API: ${error.message}`, true);
                return null;
            }
        }

        // --- RENDER FUNCTIONS ---
        
        /**
         * –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫—É–ø–ª–µ–Ω–Ω–æ–π –æ—Ç—Ä–∞—Å–ª–∏.
         */
        function renderOwnedIndustry(industry, masterData) {
            const industryData = masterData.find(d => d.id === industry.id);
            if (!industryData) return '';

            const currentIncome = industryData.base_income * industry.level;

            return `
                <div class="card border border-sky-600/50 flex justify-between items-center">
                    <div>
                        <p class="text-xl font-bold text-sky-300">${industryData.name} (–£—Ä. ${industry.level})</p>
                        <p class="text-sm text-gray-400">
                            –î–æ—Ö–æ–¥: +${currentIncome.toLocaleString()} BSS / ${industryData.cycle_time_sec} —Å–µ–∫
                        </p>
                    </div>
                    <!-- –ö–Ω–æ–ø–∫–∞ —É–ª—É—á—à–µ–Ω–∏—è -->
                    <button data-industry-id="${industry.id}" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg text-sm disabled:opacity-50" disabled>
                        –£–ª—É—á—à–∏—Ç—å
                    </button>
                </div>
            `;
        }

        /**
         * –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ–π –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –æ—Ç—Ä–∞—Å–ª–∏.
         */
        function renderAvailableIndustry(industry) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫—É–ø–ª–µ–Ω–∞ –ª–∏ —É–∂–µ —ç—Ç–∞ –æ—Ç—Ä–∞—Å–ª—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ä–∞–∑
            const isOwned = playerState.industries.some(ind => ind.id === industry.id);
            const canAfford = playerState.score >= industry.base_cost;
            
            // –ï—Å–ª–∏ –æ—Ç—Ä–∞—Å–ª—å —É–∂–µ –∫—É–ø–ª–µ–Ω–∞, –µ–µ –Ω–µ–ª—å–∑—è –∫—É–ø–∏—Ç—å —Å–Ω–æ–≤–∞
            const isDisabled = isOwned || !canAfford;
            
            return `
                <div class="card border border-slate-500/50">
                    <div class="flex justify-between items-start">
                        <h3 class="text-lg font-semibold text-white">${industry.id}. ${industry.name}</h3>
                        <p class="text-sm text-yellow-300 font-bold">${industry.base_cost.toLocaleString()} BSS</p>
                    </div>
                    <p class="text-sm text-gray-400 mt-1 mb-3">${industry.description}</p>
                    <div class="flex justify-end">
                        <button 
                            data-industry-id="${industry.id}"
                            data-cost="${industry.base_cost}"
                            class="buy-button bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg text-sm disabled:opacity-50"
                            ${isDisabled ? 'disabled' : ''}
                        >
                            ${isOwned ? '–ö—É–ø–ª–µ–Ω–æ' : '–ö—É–ø–∏—Ç—å'}
                        </button>
                    </div>
                </div>
            `;
        }
        
        /**
         * –û–±–Ω–æ–≤–ª—è–µ—Ç –≤–µ—Å—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ playerState.
         */
        function updateUI() {
            // 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞
            scoreDisplay.textContent = playerState.score.toLocaleString() + ' BSS';
            
            // 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏
            profitDisplay.textContent = playerState.accumulated_profit.toLocaleString() + ' BSS';
            collectButton.disabled = playerState.accumulated_profit === 0;
            
            // 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π –º–æ—â–Ω–æ—Å—Ç–∏
            productionDisplay.textContent = `–û–±—â–∏–π –¥–æ—Ö–æ–¥ –∑–∞ —Ü–∏–∫–ª: ${playerState.total_production.toLocaleString()} BSS`;
            
            // 4. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –æ—Ç—Ä–∞—Å–ª–µ–π
            if (playerState.industries.length === 0) {
                ownedList.innerHTML = `<p class="text-gray-400 text-center">
                    –£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç –æ—Ç—Ä–∞—Å–ª–µ–π. –ö—É–ø–∏—Ç–µ –ø–µ—Ä–≤—É—é!
                </p>`;
            } else {
                ownedList.innerHTML = playerState.industries
                    .map(ind => renderOwnedIndustry(ind, masterIndustries))
                    .join('');
            }

            // 5. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ—Ç—Ä–∞—Å–ª–µ–π
            const availableToBuy = masterIndustries.filter(masterInd => 
                !playerState.industries.some(ownedInd => ownedInd.id === masterInd.id)
            );

            if (availableToBuy.length > 0) {
                availableList.innerHTML = masterIndustries
                    .map(industry => renderAvailableIndustry(industry))
                    .join('');
            } else if (playerState.industries.length === masterIndustries.length) {
                availableList.innerHTML = `<p class="text-green-400 text-center font-semibold">
                    –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∫—É–ø–∏–ª–∏ –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –æ—Ç—Ä–∞—Å–ª–∏.
                </p>`;
            } else {
                 availableList.innerHTML = `<p class="text-gray-400 text-center">
                    –ü–æ–∫—É–ø–∞–π—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–µ –æ—Ç—Ä–∞—Å–ª–∏!
                </p>`;
            }
                
            // 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª—É—à–∞—Ç–µ–ª–µ–π –ø–æ–∫—É–ø–∫–∏
            attachBuyListeners();
        }

        /**
         * –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ä–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏ (–∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É) –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞.
         */
        function periodicProfitUpdate() {
            if (playerState.total_production > 0) {
                const currentTime = Math.floor(Date.now() / 1000);
                const timePassedSinceLastCheck = currentTime - playerState.last_check_time;
                
                let tempProfit = 0;
                let hasProfit = false;
                
                // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∏–±—ã–ª—å, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –º–∞—Å—Ç–µ—Ä–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏
                for (const ownedIndustry of playerState.industries) {
                    const masterData = masterIndustries.find(d => d.id === ownedIndustry.id);
                    if (!masterData) continue;
                    
                    const currentIncome = masterData.base_income * ownedIndustry.level;
                    const currentCycleTime = masterData.cycle_time_sec;
                    
                    if (currentCycleTime > 0) {
                        const cyclesCompleted = Math.floor(timePassedSinceLastCheck / currentCycleTime);
                        tempProfit += cyclesCompleted * currentIncome;
                        if (cyclesCompleted > 0) hasProfit = true;
                    }
                }
                
                playerState.accumulated_profit = tempProfit;
                profitDisplay.textContent = tempProfit.toLocaleString() + ' BSS';
                collectButton.disabled = !hasProfit;

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –ø–æ–∫—É–ø–∫–∏ (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –Ω–∞–∫–æ–ø–∏–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥)
                attachBuyListeners(); 
            }
        }
        
        /**
         * –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–æ–∫—É–ø–∫–∏.
         */
        function attachBuyListeners() {
            document.querySelectorAll('.buy-button').forEach(button => {
                const cost = parseInt(button.dataset.cost);
                const industryId = parseInt(button.dataset.industryId);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞, –º–æ–∂–µ—Ç –ª–∏ –∏–≥—Ä–æ–∫ –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–µ–±–µ –ø–æ–∫—É–ø–∫—É
                const isOwned = playerState.industries.some(ind => ind.id === industryId);
                button.disabled = isOwned || playerState.score < cost;
                
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
                button.removeEventListener('click', handleBuy);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å
                button.addEventListener('click', handleBuy);
            });
        }
        
        // --- EVENT HANDLERS ---
        
        async function handleCollect() {
            collectButton.disabled = true;
            showMessage("–°–±–æ—Ä –ø—Ä–∏–±—ã–ª–∏...");
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º USER_ID –≤ –ø—É—Ç–∏
            const data = await apiRequest(`/collect/${USER_ID}`, 'POST');
            
            if (data) {
                playerState.score = data.score;
                playerState.accumulated_profit = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Å–ª–µ —Å–±–æ—Ä–∞
                playerState.last_check_time = Math.floor(Date.now() / 1000); // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
                showMessage(`–£—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω–æ ${data.collected.toLocaleString()} BSS!`);
                updateUI();
            } else {
                 collectButton.disabled = false; // –í–∫–ª—é—á–∞–µ–º, –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞
            }
        }
        
        async function handleBuy(event) {
            const button = event.currentTarget;
            button.disabled = true;
            const industryId = parseInt(button.dataset.industryId);
            
            showMessage(`–ü–æ–∫—É–ø–∫–∞ –æ—Ç—Ä–∞—Å–ª–∏ #${industryId}...`);
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º USER_ID –∏ industryId –≤ –ø—É—Ç–∏
            const data = await apiRequest(`/buy/${USER_ID}/${industryId}`, 'POST');
            
            if (data) {
                playerState.score = data.score;
                playerState.industries.push(data.new_industry); // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –æ—Ç—Ä–∞—Å–ª—å
                playerState.total_production = data.total_production;
                showMessage(`–í—ã —É—Å–ø–µ—à–Ω–æ –∫—É–ø–∏–ª–∏ ${data.new_industry.industry_name}!`);
                updateUI();
            }
            
            // –ö–Ω–æ–ø–∫–∞ –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ updateUI
            button.disabled = false;
        }

        /**
         * –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã.
         */
        async function initGame() {
            loadingStatus.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Å—Ç–µ—Ä-–¥–∞–Ω–Ω—ã—Ö...";
            
            // 1. –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Å—Ç–µ—Ä-–¥–∞–Ω–Ω—ã—Ö
            const masterData = await apiRequest('/master-data');
            if (!masterData) {
                loadingStatus.textContent = "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.";
                return;
            }
            masterIndustries = masterData;
            
            loadingStatus.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä–æ–∫–∞...";

            // 2. –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä–æ–∫–∞
            const stateData = await apiRequest(`/state/${USER_ID}`);
            if (!stateData) {
                 loadingStatus.textContent = "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä–æ–∫–∞.";
                 return;
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            playerState = {
                score: stateData.score,
                industries: stateData.industries,
                accumulated_profit: stateData.accumulated_profit,
                total_production: stateData.total_production,
                last_check_time: stateData.last_check_time || Math.floor(Date.now() / 1000)
            };
            
            loadingStatus.classList.add('hidden');

            // 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π
            collectButton.addEventListener('click', handleCollect);
            attachBuyListeners();

            // 4. –ó–∞–ø—É—Å–∫ UI
            updateUI();
            
            // 5. –ó–∞–ø—É—Å–∫ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–±—ã–ª–∏
            if (uiUpdateInterval) clearInterval(uiUpdateInterval);
            uiUpdateInterval = setInterval(periodicProfitUpdate, 1000); 
            
            // –î–µ–ª–∞–µ–º –ø–µ—Ä–≤–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
            periodicProfitUpdate();
        }

        // --- Firebase/Auth Setup (Mandatory in Canvas) ---
        
        // –í—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π –±–ª–æ–∫ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –Ω–∞–ª–∏—á–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤
        // –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö Firebase, –¥–∞–∂–µ –µ—Å–ª–∏ –º—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö –Ω–∞–ø—Ä—è–º—É—é –≤ —ç—Ç–æ–º JS –∫–æ–¥–µ.
        // –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å—Ä–µ–¥—ã Canvas.
        
        /* import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setDoc, doc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // –ò–º–∏—Ç–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö Canvas (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∏–∑–±–µ–∂–∞–Ω–∏—è –æ—à–∏–±–æ–∫)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // –ü—Ä–æ—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ —Å—Ä–µ–¥—ã
        try {
             if (Object.keys(firebaseConfig).length > 0) {
                 const app = initializeApp(firebaseConfig);
                 const auth = getAuth(app);
                 if (initialAuthToken) {
                    signInWithCustomToken(auth, initialAuthToken).catch(console.error);
                 } else {
                    signInAnonymously(auth).catch(console.error);
                 }
             }
        } catch (e) {
            console.error("Firebase Auth setup failed:", e);
        }
        */
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        window.onload = initGame;
    </script>
</body>
</html>
